<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Local GPU AI Assistant</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400;600&family=Comic+Neue:wght@400;700&family=VT323&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<link rel="stylesheet" href="/static/css/app.css">
<link rel="stylesheet" href="/static/css/setup_wizard.css">
<link rel="stylesheet" href="/static/css/updater_ui.css">


</head>
<body class="theme-default">

<!-- GLOBAL DIM OVERLAY -->
<div id="dim-overlay"></div>

<!-- FIRST RUN TUTORIAL OVERLAY -->
<div id="frt-overlay">
    <div id="frt-content">
        <div id="narrator-orb" class="orb-avatar"></div>
        <div id="frt-text">System Online. No model loaded.</div>
        <div id="frt-nav">
            <button id="frt-back" aria-label="Back">&lt;</button>
            <button id="frt-advance" aria-label="Next">&gt;</button>
        </div>
        <div id="frt-tip" aria-live="polite">
            Hold <kbd>Space</kbd> to fast-forward
        </div>
        <div id="frt-prompt-readout" aria-live="polite"></div>
        <div id="frt-optional" aria-live="polite"></div>
    </div>
</div>

<!-- RPG QUESTIONNAIRE OVERLAY -->
<div id="rpg-questionnaire" class="rpg-overlay hidden">
    <div class="rpg-container">
        <div class="rpg-question-box">
            <div class="rpg-question-text"></div>
            <div class="rpg-choices"></div>
            <div class="rpg-nav">
                <button class="rpg-back" id="rpg-back-btn">‚óÑ BACK</button>
                <button class="rpg-next" id="rpg-next-btn">NEXT ‚ñ∫</button>
            </div>
        </div>
    </div>
</div>

<!-- RPG LOADING SCREEN -->
<div id="rpg-loading" class="rpg-overlay hidden">
    <div class="rpg-loading-content">
        <div class="rpg-loading-text">Crafting your personalized system prompt...</div>
        <div class="rpg-loading-dots">
            <span>.</span><span>.</span><span>.</span>
        </div>
    </div>
</div>

<!-- RPG PROMPT REVIEW SCREEN -->
<div id="prompt-review" class="rpg-overlay hidden">
    <div class="rpg-review-content">
        <div class="rpg-review-header">
            <h2 class="rpg-review-title">YOUR PERSONALIZED SYSTEM PROMPT</h2>
            <p class="rpg-review-subtitle">Edit your prompt to fine-tune your AI assistant</p>
        </div>

        <div class="prompt-editor-box">
            <textarea id="prompt-editor" class="prompt-editor-textarea" rows="10" spellcheck="false"></textarea>
            <div class="prompt-metadata">
                <span class="char-count">
                    <span id="prompt-length">0</span> characters
                </span>
            </div>
        </div>

        <div class="rpg-review-actions">
            <button id="btn-start-over" class="rpg-btn rpg-btn-secondary">
                ‚óÑ START OVER
            </button>
            <button id="btn-use-prompt" class="rpg-btn rpg-btn-primary">
                USE THIS PROMPT ‚ñ∫
            </button>
        </div>
    </div>
</div>

<!-- FINAL REVIEW OVERLAY -->
<div id="final-review-overlay" class="rpg-overlay hidden">
    <div class="rpg-review-content">
        <div class="rpg-review-header">
            <h2 class="rpg-review-title">REVIEW YOUR PROFILE</h2>
        </div>

        <div class="setting-group">
            <label>SYSTEM PROMPT</label>
            <div class="prompt-editor-box">
                <textarea id="final-review-prompt" class="prompt-editor-textarea" rows="6" spellcheck="false" readonly></textarea>
            </div>
        </div>

        <div class="setting-group">
            <label>TIER A (IDENTITY)</label>
            <div id="final-review-tier-a" class="mem-section">
                <div style="font-style:italic; color:rgba(255,255,255,0.2); font-size:0.75rem;">Empty</div>
            </div>
        </div>

        <div class="setting-group">
            <label>TIER B (INTERESTS)</label>
            <div id="final-review-tier-b" class="mem-section">
                <div style="font-style:italic; color:rgba(255,255,255,0.2); font-size:0.75rem;">Empty</div>
            </div>
        </div>

        <div class="rpg-review-actions">
            <button id="btn-final-review-confirm" class="rpg-btn rpg-btn-primary">
                LOOKS GOOD ‚Üí
            </button>
        </div>
    </div>
</div>

<!-- BOOT SCREEN -->
<div id="boot-screen">
  <div class="boot-content">
    <div class="boot-title">
      <div>The Good.</div>
      <div>The Bad.</div>
      <div>The Ugly.</div>
    </div>
    <div class="boot-subtitle">Private, GPU-accelerated intelligence.</div>
    <button id="btn-begin" class="boot-begin">Begin</button>
  </div>
</div>

<div class="app-container">
    <div class="sidebar" id="sidebar">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="app-title">Local AI</div>
        </div>
        <button id="btn-new-chat" class="btn-new-chat"><span>+</span><span class="btn-label">New Chat</span></button>
        <div class="session-list" id="session-list">
            <div style="padding:10px; opacity:0.5; font-size:0.8rem;">Loading...</div>
        </div>

        <!-- NEW: Collapsed Setting Button (Rail Mode) -->
        <button class="btn-open-settings-rail" id="btn-open-settings-rail" title="Settings">‚öôÔ∏è</button>

        <div class="sidebar-footer">
            <button class="btn-icon-text" id="btn-open-settings-sidebar"><span>‚öôÔ∏è</span><span class="btn-label">Settings</span></button>
            <div style="padding: 0 12px; font-size: 0.75rem; color: var(--text-secondary); display:flex; gap:8px; align-items:center;">
                <div id="status-dot" class="status-indicator offline"></div>
                <span id="conn-status">Disconnected</span>
            </div>
        </div>
    </div>

    <div class="chat-area">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <button id="btn-sidebar-toggle" class="btn-sidebar-toggle" title="Toggle Sidebar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
                </button>
                <div id="model-display" class="model-badge">No Model Loaded</div>
                <div id="prompt-swap-indicator" class="prompt-swap-indicator">System prompt updated</div>
                <span class="top-bar-divider">|</span>
                <div id="session-title" class="session-title">New Session</div>
            </div>
            <div style="display:flex; align-items:center; gap:8px;">
                <button id="btn-search-toggle" class="btn-search-toggle">WEB SEARCH: OFF</button>
            </div>
        </div>

        <div id="chat-history" class="chat-history">
            <div class="welcome-container">
                <h3 class="welcome-title">Welcome to Local AI</h3>
                <p class="welcome-text">Private, GPU-accelerated intelligence.</p>
                <button class="btn-full" style="width:auto; margin-top:20px; padding: 10px 24px;" onclick="toggleSettings(true)">Load Model</button>
            </div>
        </div>

        <div class="input-wrapper">
            <div class="input-container">
                <div class="hat-decoration">
                    <svg viewBox="0 0 100 80" xmlns="http://www.w3.org/2000/svg">
                        <ellipse cx="50" cy="50" rx="45" ry="12" fill="#fcd34d" stroke="#d97706" stroke-width="2"/>
                        <path d="M30,50 Q30,20 50,20 Q70,20 70,50" fill="#fcd34d" stroke="#d97706" stroke-width="2"/>
                        <path d="M32,45 Q50,45 68,45 L68,50 Q50,50 32,50 Z" fill="#ef4444" stroke="#b91c1c" stroke-width="1"/>
                    </svg>
                </div>
                <div id="tui-prefix">‚ûú ~</div>
                <textarea id="prompt" rows="1" placeholder="Type a message..."></textarea>
                <div class="input-actions"><button id="send-btn">SEND</button></div>
            </div>
            <div style="text-align:center; font-size:0.75rem; color:var(--text-secondary); margin-top:12px; opacity:0.6;">Shift+Enter for newline</div>
        </div>
    </div>

    <!-- RIGHT RAIL (Collapsed Icon Menu) -->
    <div id="right-rail" class="right-rail">
        <button id="btn-rail-model" class="rail-btn" title="ModelSelection">‚óà</button>
        <button id="btn-rail-temp" class="rail-btn" title="Temperature">‚ö°</button>
        <button id="btn-rail-memory" class="rail-btn" title="Memory">üíæ</button>
        <button id="btn-rail-appearance" class="rail-btn" title="Appearance">‚óë</button>
    </div>
</div>

<!-- RIGHT SIDEBAR (Replaces Settings Overlay) -->
<div id="right-sidebar">
    <div class="settings-header">
        <h2>Configuration</h2>
        <button class="btn-close" id="btn-close-settings">&times;</button>
    </div>

    <div class="settings-content">
        <div class="setting-group" id="grp-model">
            <label>Model Selection</label>
            <select id="model-select"><option>Scanning...</option></select>
            <!-- MODEL METADATA DISPLAY -->
            <div id="model-metadata-display" style="font-size: 0.75rem; color: var(--text-secondary); margin: 8px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 4px; display:none; border: 1px solid var(--border-subtle);">
                <!-- Populated via JS -->
            </div>
            <button id="btn-load" class="btn-full">LOAD MODEL</button>
            <div id="model-status" style="font-size:0.8rem; text-align:center; opacity:0.7; margin-top:5px;">STATUS: OFFLINE</div>
        </div>

        <hr style="border:0; border-top:1px dashed var(--border-subtle);">

        <!-- MEMORY MATRIX CONTAINER (NEW) -->
        <div id="memory-matrix-container" style="display:none;">
            <div class="setting-group">
                <label style="color:#60A5FA;">Memory Matrix</label>
                <div class="mem-section" id="mem-tier-a">
                    <div class="mem-title">Identity (Tier A)</div>
                    <!-- JS populated -->
                    <div style="font-style:italic; color:rgba(255,255,255,0.2); font-size:0.75rem;">Empty</div>
                </div>
                <div class="mem-section" id="mem-tier-b">
                    <div class="mem-title">Interests (Tier B)</div>
                    <div class="mem-tag-container" id="mem-tier-b-tags">
                        <div style="font-style:italic; color:rgba(255,255,255,0.2); font-size:0.75rem;">Empty</div>
                    </div>
                </div>
                <button id="btn-refresh-memory" class="btn-full" style="margin-top:12px;">Refresh Memory</button>
            </div>
            <hr style="border:0; border-top:1px dashed var(--border-subtle);">
        </div>

        <!-- WEB UPLINK CONTAINER (NEW) -->
        <div id="web-uplink-container" style="display:none;">
            <div class="setting-group">
                <label style="color:#A78BFA;">Web Uplink</label>
                <div class="mem-section">
                    <div class="mem-kv"><span class="mem-k">Mode</span> <span class="mem-v" id="disp-web-mode">OFF</span></div>
                    <div class="mem-kv"><span class="mem-k">Provider</span> <span class="mem-v" id="disp-web-provider">AUTO</span></div>
                </div>
            </div>
            <hr style="border:0; border-top:1px dashed var(--border-subtle);">
        </div>

        <div class="setting-group" id="grp-wallpaper">
            <label>Wallpaper</label>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="file" id="wallpaper-upload" accept="image/png, image/jpeg" style="display:none;">
                <button class="btn-full" onclick="document.getElementById('wallpaper-upload').click()">Upload Image</button>
                <button id="btn-remove-wallpaper" class="btn-full" style="background:#EF4444; color:white; width:auto; padding: 14px 18px;">‚úñ</button>
            </div>

            <div style="margin-top:12px;">
                <div class="row-spread"><label>Opacity</label><span id="val-opacity">10%</span></div>
                <input type="range" id="slider-opacity" min="0" max="100" value="10">
            </div>
        </div>

        <hr style="border:0; border-top:1px dashed var(--border-subtle);">

        <div class="setting-group" id="grp-gpu">
            <div class="row-spread"><label>GPU Layers</label><input type="number" id="num-layers" value="35" min="0" max="99" style="width:70px;"></div>
            <input type="range" id="slider-layers" min="0" max="99" value="35">
        </div>

        <div class="setting-group" id="grp-ctx">
            <div class="row-spread"><label>Context Size (n_ctx)</label><input type="number" id="num-ctx" value="4096" step="512" style="width:80px;"></div>
            <input type="range" id="slider-ctx" min="512" max="32768" step="512" value="4096">
        </div>

        <div class="setting-group" id="grp-temp">
            <div class="row-spread"><label>Temperature</label><input type="number" id="num-temp" value="0.7" step="0.1" max="2.0" style="width:60px;"></div>
            <input type="range" id="slider-temp" min="0" max="20" value="7">
        </div>

        <!-- NEW: ACCENT COLOR -->
        <div class="setting-group" id="grp-accent">
            <div class="row-spread"><label>Accent Color</label><input type="color" id="picker-accent" value="#ffffff" style="width:60px; height:30px; padding:0; border:none; background:none;"></div>
        </div>

        <div class="setting-group" id="grp-theme">
            <label>Interface Theme</label>
            <select id="theme-select">
                <option value="theme-default">Dark (Default)</option>
                <option value="theme-tui">Terminal (TUI)</option>
                <option value="theme-brutalist">Neo-Brutalist</option>
                <option value="theme-onepiece">Grand Line (One Piece)</option>
            </select>
        </div>

        <!-- DEV BUTTON (Temporary Reset Tutorial Button) -->
        <div class="setting-group">
            <button id="btn-reset-tutorial" class="btn-full" style="background:#EF4444; color:white; font-size:0.8rem; margin-top: 10px;">[DEV] RESET TUTORIAL</button>
        </div>
    </div>
</div>

<script defer src="/static/js/setup_wizard.js"></script>
<script defer src="/static/js/updater_ui.js"></script>
<script defer src="/static/js/app.js"></script>



</body>
</html>
